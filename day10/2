def calculate_new_state(actual_state, comb):
    result = actual_state[::]
    for e in comb:
        result[e] = not actual_state[e]
    return result

def get_comb(goal, l):
    initial_state = [False] * len(goal)
    q = [initial_state, None]
    res = 1
    while True:
        actual_state = q.pop(0)
        if actual_state is None:
            res += 1
            q.append(None)
            actual_state = q.pop(0)
        for c in l:
            temp_state = calculate_new_state(actual_state, c)
            if temp_state == goal:
                return res
            q.append(temp_state)

with open("input", "r") as file:
    lines = file.readlines()

for line in lines:
    temp = line.split()
    goal = [c == "#" for c in temp[0][1:-1]]
    combi = [[int(e) for e in t[1:-1].split(",")] for t in temp[1:-1]]
    print(get_comb(goal, combi))
